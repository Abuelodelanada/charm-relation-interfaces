{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://canonical.github.io/charm-relation-interfaces/interfaces/kratos_external_idp/v0/schemas/provider.json",
    "type": "object",
    "title": "Kratos external idp provider schema",
    "description": "The `kratos_external_idp` root schema comprises the entire provider databag for this interface.",
    "default": {},
    "examples": [
        {
            "microsoft": [
                {
                    "client_id": "client_id",
                    "client_secret": "cl1ent-s3cRet",
                    "secret_backend": "relation",
                    "tenant_id": "4242424242424242"
                },
                {
                    "client_id": "client_id_2",
                    "client_secret": "pazzw0rD",
                    "secret_backend": "vault",
                    "tenant_id": "4242424242424242"
                }
            ],
            "google": [
                {
                    "client_id": "client",
                    "client_secret": "aba",
                    "secret_backend": "relation"
                }
            ]
        }
    ],
    "required": [],
    "properties": {
        "microsoft": {
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": true,
                "required": [
                    "client_id",
                    "client_secret",
                    "secret_backend",
                    "tenant_id",
                ],
                "properties": {
                    "client_id": {"$ref": "/schemas/client_id"},
                    "client_secret": {"$ref": "/schemas/client_secret"},
                    "secret_backend": {"$ref": "/schemas/secret_backend"},
                    "tenant_id": {
                        "title": "The Azure AD tenant_id which the users belong to",
                        "description": "The Azure AD tenant_id which the users belong to",
                        "type": "string"
                    }
                }
            }
        },
        "apple": {
            "type": "array",
            "items": {
                "type": "object",
                "additionalProperties": true,
                "required": [
                    "client_id",
                    "private_key",
                    "private_key_id",
                    "secret_backend",
                    "team_id"
                ],
                "properties": {
                    "client_id": {"$ref": "/schemas/client_id"},
                    "private_key": {
                        "title": "The private key generated by Apple",
                        "description": "The private key generated by Apple",
                        "type": "string"
                    },
                    "private_key_id": {
                        "title": "The private key identifier generated by Apple",
                        "description": "The private key identifier generated by Apple",
                        "type": "string"
                    },
                    "secret_backend": {"$ref": "/schemas/secret_backend"},
                    "team_id": {
                        "title": "The Team ID provided by Apple",
                        "description": "The Team ID provided by Apple",
                        "type": "string"
                    }
                }
            }
        },
        "generic": {
            "type": "array",
            "items": {"$ref": "/schemas/generic_provider"}
        },
        "auth0": {
            "type": "array",
            "items": {"$ref": "/schemas/generic_provider"}
        },
        "google": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "facebook": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "github": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "gitlab": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "slack": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "spotify": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "discord": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "twitch": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "netid": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "yandex": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "vk": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        },
        "dingtalk": {
            "type": "array",
            "items": {"$ref": "/schemas/known_provider"}
        }
    },
    "$defs": {
        "client_id": {
            "$id": "/schemas/client_id",
            "title": "The client_id for the Kratos client",
            "description": "The registered client_id that will be used by Kratos to authenticate with the external idp",
            "type": "string",
            "examples": [
                "some_random_string"
            ]
        },
        "client_secret": {
            "$id": "/schemas/client_secret",
            "title": "The client_secret for the Kratos client",
            "description": "The registered client_secret that will be used by Kratos to authenticate with the external idp",
            "type": "string",
            "examples": [
                "h4ckerz"
            ]
        },
        "issuer_url": {
            "$id": "/schemas/issuer_url",
            "title": "The external provider's issuer_url",
            "description": "The external provider's issuer_url",
            "type": "string",
            "examples": [
                "https://example.com/oidc"
            ]
        },
        "secret_backend": {
            "$id": "/schemas/secret_backend",
            "title": "Where the secrets are stored",
            "description": "Where the secrets are stored",
            "type": "string",
            "default": "relation",
            "enum": [
                "relation",
                "secret",
                "vault"
            ],
            "examples": [
                "relation"
            ]
        },
        "generic_provider": {
            "$id": "/schemas/generic_provider",
            "type": "object",
            "properties": {
                "client_id": {
                    "$ref": "/schemas/client_id"
                },
                "client_secret": {
                    "$ref": "/schemas/client_secret"
                },
                "issuer_url": {
                    "$ref": "/schemas/issuer_url"
                },
                "secret_backend": {
                    "$ref": "/schemas/secret_backend"
                }
            },
            "required": [
                "client_id",
                "client_secret",
                "issuer_url",
                "secret_backend"
            ],
            "additionalProperties": true
        },
        "known_provider": {
            "$id": "/schemas/known_provider",
            "type": "object",
            "properties": {
                "client_id": {
                    "$ref": "/schemas/client_id"
                },
                "client_secret": {
                    "$ref": "/schemas/client_secret"
                },
                "secret_backend": {
                    "$ref": "/schemas/secret_backend"
                }
            },
            "required": [
                "client_id",
                "client_secret",
                "secret_backend"
            ],
            "additionalProperties": true
        }
    },
    "additionalProperties": true
}